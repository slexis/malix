<div data-role="page">
  <div class="navbar light-green darken-2">
    <div class="navbar-inner">
      <div class="left">
        <a href="#" class="link" data-rel="back"><i class="material-icons">arrow_back</i></a>
      </div>
      <div class="title">Vẽ đồ thị</div>
      <div class="right">
        <a href="#" class="link" id="btn-more"><i class="material-icons">add</i></a>
      </div>
    </div>
  </div>
  <div class="ui-content">
    <div class="card">
      <label>Nhập hàm số</label>
      <input type="text" data-clear-btn="true" id="input1" value="x" />
    </div>
    <div id="more" style="display:none">
      <div class="card">
        <label>Nhập hàm số 2</label>
        <input type="text" data-clear-btn="true" id="input2" value="0" />
      </div>
      <div class="card">
        <label>Nhập hàm số 3</label>
        <input type="text" data-clear-btn="true" id="input3" value="0" />
      </div>
    </div>
    <div class="card">
      <div class="overflow center">
        <div id="plot"></div>
      </div>
    </div>
  </div>
  <script>
  $.getScript('../js/graph.js', function() {

    $('#btn-more .material-icons').click(function() {
      $('#more').slideToggle('slow');
      $(this).text($(this).text() === 'add' ? 'remove' : 'add');
    });

    $('#input1,#input2,#input3').textcomplete([{
      match: /(^|\b)(\w{1,})$/,
      search: function(term, callback) {
        var words = ['cos', 'sin', 'tan', 'sqrt', 'abs', 'asin', 'acos', 'atan'];
        callback($.map(words, function(word) {
          return word.indexOf(term) === 0 ? word : null;
        }));
      },
      replace: function(word) {
        return `${word}()`;
      }
    }]);

    function draw() {
      functionPlot({
        target: '#plot',
        grid: true,
        width: 350,
        tip: {
          xLine: true,
          yLine: true,
        },
        data: [{
          fn: input1.value.replace(/ln/g, 'log'),
          graphType: 'polyline',
          updateOnMouseMove: true
        }, {
          fn: input2.value.replace(/ln/g, 'log'),
          graphType: 'polyline',
          updateOnMouseMove: true
        }, {
          fn: input3.value.replace(/ln/g, 'log'),
          graphType: 'polyline',
          updateOnMouseMove: true
        }]
      });
    }

    $('#input1,#input2,#input3').on('input', function(event) {
      event.preventDefault();
      draw();
    })

    $('#input1,#input2,#input3').focus(function() {
      if ($(this).val().includes('()')) {
        input1.selectionStart = input1.selectionEnd = input1.value.indexOf('()') + 1;
        input2.selectionStart = input2.selectionEnd = input2.value.indexOf('()') + 1;
        input3.selectionStart = input3.selectionEnd = input3.value.indexOf('()') + 1;
      }
    })

    draw();
  })
  </script>
</div>