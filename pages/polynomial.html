<div data-role="page">
  <style>
  .ui-selectmenu .ui-selectmenu-list li .ui-btn.ui-btn-active {
    color: #0288d1
  }
  </style>
  <div class="navbar light-blue darken-2">
    <div class="navbar-inner">
      <div class="left">
        <a href="" class="link" data-rel="back"><i class="material-icons">arrow_back</i></a>
      </div>
      <div class="title">Đa thức</div>
      <div class="right">
        <select data-native-menu="false" id="select" data-icon="false">
          <option value="e">E</option>
          <option value="f">F</option>
          <option value="c">C</option>
          <option value="p">P</option>
        </select>
      </div>
    </div>
  </div>
  <div class="ui-content">
    <div id="main_area">
      <div class="card">
        <label>Nhập đa thức</label>
        <input type="text" id="input" placeholder="(x-1)^2*(2x-5)-7x+8" data-clear-btn="true" />
      </div>
      <div class="row" id="coeff_area">
        <div class="col-50">
          <div class="card">
            <label>Hệ số tại</label>
            <input type="text" placeholder="2" id="coeff" />
          </div>
        </div>
      </div>
    </div>
    <div id="lagrange_area">
      <div class="card">
        <label>Nhập các giá trị của biến</label>
        <input type="text" id="xs" placeholder="1 2 3" data-clear-btn="true" />
      </div>
      <div class="card">
        <label>Nhập các giá trị của hàm</label>
        <input type="text" id="fs" placeholder="1 2 3" data-clear-btn="true" />
      </div>
    </div>
    <button class="button katex light-blue darken-2">=</button>
    <div class="card">
      <div class="overflow">
        <div id="output">
          <span class="katex-display katex">0</span>
        </div>
      </div>
    </div>
  </div>
  <script>
  $.getScript('../js/algebra.js', function() {

    function hermite(n) {
      let h = '';
      for (let m = 0; m <= Math.floor(n / 2); m++) {
        h += `(${((-1) ** m) * (2 ** (n - 2 * m))}x^${n - 2 * m})/${Math2.factorial(m) * Math2.factorial(n - 2 * m)}+`
      }
      return _.parse(`${Math2.factorial(n)}*(${h.replace(/\+$/, '')})`)
    }

    function hermiteE(n) {
      let h = '';
      for (let m = 0; m <= Math.floor(n / 2); m++) {
        h += `(${(-1) ** m}x^${n - 2 * m})/${(2 ** m) * Math2.factorial(m) * Math2.factorial(n - 2 * m)}+`
      }
      return _.parse(`${Math2.factorial(n)}*(${h.replace(/\+$/, '')})`)
    }

    function legendreP(n) {
      let l = '';
      for (let k = 0; k <= n; k++) {
        l += `${binom(n, k) ** 2}(x-1)^${n - k}(x+1)^${k}+`
      }
      return _.parse(`(${l.replace(/\+$/, '')})/2^${n}`)
    }

    function laguerre(n) {
      let l = '';
      for (let k = 0; k <= n; k++) {
        l += `${binom(n, k) * ((-1) ** k) / Math2.factorial(k)}x^${k}+`
      }
      return _.parse(l.replace(/\+$/, ''))
    }

    function chebyshevT(n) {
      let c = '';
      for (let k = 0; k <= Math.floor(n / 2); k++) {
        c += `${binom(n, 2 * k)}(1-x^(-2))^${k}+`
      }
      return _.parse(`x^${n}*(${c.replace(/\+$/, '')})`)
    }

    function chebyshevU(n) {
      let c = '';
      for (let k = 0; k <= Math.floor(n / 2); k++) {
        c += `${binom(n + 1, 2 * k + 1)}(1-x^(-2))^${k}+`
      }
      return _.parse(`x^${n}*(${c.replace(/\+$/, '')})`)
    }

    nerdamer.register([{
      name: 'laguerre',
      numargs: 1,
      visible: !0,
      build: function() {
        return laguerre
      }
    }, {
      name: 'legendreP',
      numargs: 1,
      visible: !0,
      build: function() {
        return legendreP
      }
    }, {
      name: 'hermite',
      numargs: 1,
      visible: !0,
      build: function() {
        return hermite
      }
    }, {
      name: 'hermiteE',
      numargs: 1,
      visible: !0,
      build: function() {
        return hermiteE
      }
    }, {
      name: 'chebyshevT',
      numargs: 1,
      visible: !0,
      build: function() {
        return chebyshevT
      }
    }, {
      name: 'chebyshevU',
      numargs: 1,
      visible: !0,
      build: function() {
        return chebyshevU
      }
    }]);

    let option = select.value;

    $('#coeff_area, #lagrange_area').hide();

    $('#select').on('change', function() {
      option = $(this).val();
      option === 'c' ? $('#coeff_area').show() : $('#coeff_area').hide();
      if (option === 'p') {
        $('#input').val('()/()');
      }
      if (main_area.style.display === 'none') {
        $('#main_area, #lagrange_area').toggle()
      }
    });

    $('.button').click(function() {
      let Input = input.value;
      let result = '';
      if (main_area.style.display === '') {
        switch (option) {
          case 'e':
            result = nerdamer(`expand(${Input})`).toTeX();
            break;
          case 'f':
            result = nerdamer(`factor(${Input})`).toTeX().replace(/\\left\((\w)\\right\)/g, '$1');
            break;
          case 'c':
            result = nerdamer(`vecget(coeffs(${Input}, x),${coeff.value} )`).toTeX();
            break;
          case 'p':
            result = nerdamer(`partfrac(${input.value},x)`).toTeX();
            break;
        }
      } else {
        let n = '';
        let d = '';
        let x = xs.value.split(' ');
        let f = fs.value.split(' ');
        for (let i = 0; i < x.length; i++) {
          result += `(${f[i]}*`;
          n = d = '';
          for (let j = 0; j < x.length; j++) {
            if (i !== j) {
              n += `(x-${x[j]})*`;
              d += `(${x[i]}-${x[j]})*`
            }
          }
          n = n.replace(/\*$/g, '');
          d = d.replace(/\*$/g, '');
          result += `${n})/(${d})+`
        }
        result = nerdamer(`expand(${result.replace(/\+-/g, '-').replace(/\+$/g, '')})`).toTeX()
      }
      output.innerHTML = katex.renderToString(result.replace(/\\cdot(?= \\| [a-z])/g, ''), {
        displayMode: !0
      })
    });

    $('#input').textcomplete([{
      match: /(^|\b)(\w{1,})$/,
      search: function(term, callback) {
        var words = ['hermite', 'hermiteE', 'legendreP', 'laguerre', 'lagrange', 'chebyshevT', 'chebyshevU'];
        callback($.map(words, function(word) {
          return word.indexOf(term) === 0 ? word : null
        }))
      },
      replace: function(word) {
        if (word !== 'lagrange') {
          return `${word}()`
        } else {
          $('#main_area, #lagrange_area').toggle()
        }
      }
    }]);
    input.onfocus = function() {
      if (this.value.indexOf('()') > -1) {
        this.selectionStart = this.selectionEnd = this.value.indexOf('()') + 1
      }
    }
  })
  </script>
</div>