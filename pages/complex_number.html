<div data-role="page">
  <div class="navbar brown darken-1">
    <div class="navbar-inner">
      <div class="left">
        <a href="" class="link" data-rel="back"><i class="material-icons">arrow_back</i></a>
      </div>
      <div class="title">Số phức</div>
    </div>
  </div>
  <div class="ui-content">
    <div class="card">
      <label>Nhập phép tính</label>
      <input type="text" id="input" placeholder="1/i" data-clear-btn="true" />
    </div>
    <div class="card overflow" id="output_area">
      <div id="output">
        <span class="katex-display katex">0</span>
      </div>
    </div>
    <div class="card overflow">
      <div id="approx_output">
        <span class="katex-display katex">0.0</span>
      </div>
    </div>
  </div>
  <script>
  $.getScript('../js/complex_number.js', function() {
    $('#input').textcomplete([{
      match: /(^|\b)(\w{1,})$/,
      search: function(term, callback) {
        var words = ['abs', 'sqrt', 'cos', 'sin', 'tan', 'sinh', 'cosh', 'tanh', 'asin', 'acos', 'atan', 'asinh', 'acosh', 'atanh', 'arg', 'conj', 'imag', 'abs', 'polar', 'real', 'rect', 'expcos', 'expsin'];
        callback($.map(words, function(word) {
          return word.indexOf(term) === 0 ? word : null
        }))
      },
      replace: function(word) {
        return `${word}()`
      }
    }])
    input.oninput = function() {
      let result = Algebrite.run(`printlatex(${this.value})`).replace(/\\sqrt{-1}/g, 'i');
      if (!/printlatex|syntax error/.test(result)) {
        if (!result.includes('.')) {
          output.innerHTML = katex.renderToString(result, {
            displayMode: true
          });
          output_area.style.display = ''
        } else {
          output_area.style.display = 'none'
        }

        approx_output.innerHTML = katex.renderToString(Algebrite.run(`printlatex(${this.value}+.0)`).replace(/\\sqrt{-1}/g, 'i'), {
          displayMode: true
        })
      }
    }

    input.onfocus = function() {
      if (this.value.indexOf('()') > -1) {
        this.selectionStart = this.selectionEnd = this.value.indexOf('()') + 1
      }
    }
  })
  </script>
</div>