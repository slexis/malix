"undefined"!=typeof module&&"undefined"==typeof nerdamer&&(nerdamer=require("./nerdamer.core.js"),require("./Algebra.js")),function(){"use strict";var e=nerdamer.getCore(),r=e.PARSER,i=e.Frac,n=e.Utils.isSymbol,t=e.groups.FN,a=e.Symbol,s=e.Utils.text,o=e.Utils.inBrackets,l=e.Utils.isInt,p=e.Utils.format,u=e.Utils.even,c=e.groups.N,f=e.groups.S,g=(t=e.groups.FN,e.groups.PL),m=e.groups.CP,w=e.groups.CB,d=e.groups.EX,v=e.groups.P,y="ln",h="abs",b="sqrt",_="sin",k="cos",q="tan",U="sec",L="csc",T="cot",S="asin",x="acos",C="atan",N="sinh",A="cosh",M="tanh";function E(e){this.message=e||""}E.prototype=new Error,a.prototype.hasIntegral=function(){return this.containsFunction("integrate")},a.prototype.fnTransform=function(){var e,i=this.args[0];if(this.isLinear())switch(this.fname){case N:e=r.parse(p("(e^({0})-e^(-({0})))/2",i));break;case A:e=r.parse(p("(e^({0})+e^(-({0})))/2",i));break;case M:e=r.parse(p("(e^({0})-e^(-({0})))/(e^({0})+e^(-({0})))",i));break;case q:e=r.parse(p("sin({0})/cos({0})",i));break;case L:e=r.parse(p("1/sin({0})",i));break;case U:e=r.parse(p("1/cos({0})",i));break;default:e=this}else if(this.power.equals(2))switch(this.fname){case _:e=r.parse(p("1/2-cos(2*({0}))/2",i));break;case k:e=r.parse(p("1/2+cos(2*({0}))/2",i));break;case q:e=r.parse(p("sin({0})^2/cos({0})^2",i));break;case A:e=r.parse(p("1/2+cosh(2*({0}))/2",i));break;case N:e=r.parse(p("-1/2+cosh(2*({0}))/2",i));break;case M:e=r.parse(p("(1+cosh(2*({0})))/(-1+cosh(2*({0})))",i));break;case U:e=r.parse(p("(1-cos(2*({0})))/(1+cos(2*({0})))+1",i));break;default:e=this}else e=this.fname===U?r.parse(p("1/cos({0})^({1})",this.args[0],this.power)):this.fname===L?r.parse(p("1/sin({0})^({1})",this.args[0],this.power)):this.fname===q?this.power.lessThan(0)?r.parse(p("cos({0})^(-({1}))/sin({0})^({1})",this.args[0],this.power.negate())):r.parse(p("sin({0})^({1})/cos({0})^({1})",this.args[0],this.power)):this.fname===_&&this.power.lessThan(0)?r.parse(p("csc({0})^(-({1}))",this.args[0],this.power.negate())):this.fname===k&&this.power.lessThan(0)?r.parse(p("sec({0})^(-({1}))",this.args[0],this.power.negate())):this.fname===_&&this.power.equals(3)?r.parse(p("(3*sin({0})-sin(3*({0})))/4",this.args[0])):this.fname===k&&this.power.equals(3)?r.parse(p("(cos(3*({0}))+3*cos({0}))/4",this.args[0])):this;return e},e.Expression.prototype.hasIntegral=function(){return this.symbol.hasIntegral()},e.Utils.in_inverse_trig=function(e){return-1!==[S,x,C,"acsc","asec","acot"].indexOf(e)},e.Utils.in_trig=function(e){return-1!==[k,_,q,U,L,T].indexOf(e)},e.Utils.in_htrig=function(e){return-1!==["sinh","cosh","tanh"].indexOf(e)};var R=e.Utils.all_functions=function(e){for(var r=0,i=e.length;r<i;r++)if(e[r].group!==t)return!1;return!0},F=e.Utils.cosAsinBtranform=function(e,i){var n,t;return n=e.args[0],t=i.args[0],r.parse(p("(sin(({0})+({1}))-sin(({0})-({1})))/2",n,t))},I=e.Utils.cosAsinAtranform=function(e,i){return 1!==Number(i.power)?r.multiply(e,i):(n=e.args[0],r.parse(p("(sin(2*({0})))/2",n)));var n},B=e.Utils.cosAsinBtranform=function(e,i){var n,t;return n=e.args[0],t=i.args[0],r.parse(p("(cos(({0})+({1}))-cos(({0})-({1})))/2",n,t))},P=e.Utils.trigTransform=function(e){for(var i,n,s={},o=new a(1),l=0,p=e.length;l<p;l++)if((i=e[l]).group===t){var u=i.fname;u===k&&s[_]?(n=s[_].args[0].toString()!==i.args[0].toString()?F(i,s[_]):I(i,s[_]),delete s[_],o=r.multiply(o,n)):u===_&&s[k]?(n=s[k].args[0].toString()!==i.args[0].toString()?F(i,s[k]):I(i,s[k]),delete s[k],o=r.multiply(o,n)):u===_&&s[_]?(s[_].args[0].toString()!==i.args[0].toString()?(n=B(i,s[_]),delete s[_]):(n=r.multiply(i,s[_]),delete s[_]),o=n):s[u]=i}else o=r.multiply(o,i);for(var c in s)o=r.multiply(o,s[c]);return o};e.Settings.integration_depth=10;var V=e.Calculus={version:"1.4.5",diff:function(l,p,u){if(e.Utils.isVector(l)){var N=new e.Vector([]);return l.each(function(e){N.elements.push(V.diff(e,p))}),N}var A=n(p)?p.text():p;if(u=n(u)?u.multiplier:u||1,void 0===A&&(A=e.Utils.variables(l)[0]),l.group===t&&l.fname===b){var M=l.args[0],E=l.power.clone();M.group===c&&M.group===v||(M.power=n(M.power)?r.multiply(M.power,r.multiply(new a(.5)),E):M.power.multiply(new i(.5)).multiply(E),M.multiplier=M.multiplier.multiply(l.multiplier)),l=M}if(l.group!==t||n(l.power))l=B(l);else{var R=B(l),F=V.diff(l.args[0].clone(),A);l=r.multiply(R,F)}return u>1&&(u--,l=V.diff(l,p,u)),l;function I(e){return(e.value===A||e.contains(A,!0))&&(e.multiplier=e.multiplier.multiply(e.power),e.power=e.power.subtract(new i(1)),e.power.equals(0)&&(e=a(e.multiplier))),e}function B(e){var l,u,b=e.group;if(b===c||b===f&&e.value!==A||b===v)e=a(0);else if(b===f)e=I(e);else{if(b===w){var N=e.multiplier.clone();e.toUnitMultiplier();var M=r.multiply(function(e){for(var i=e.collectSymbols(),n=new a(0),t=i.length,s=0;s<t;s++){for(var o=V.diff(i[s].clone(),A),l=0;l<t;l++)s!==l&&(o=r.multiply(o,i[l].clone()));n=r.add(n,o)}return n}(e),I(e));return M.multiplier=M.multiplier.multiply(N),M}if(b===t&&e.power.equals(1))switch(e.fname){case y:u=e.clone(),(e=e.args[0].clone()).power=e.power.negate(),e.multiplier=u.multiplier.divide(e.multiplier);break;case k:e.fname=_,e.multiplier.negate();break;case _:e.fname=k;break;case q:e.fname=U,e.power=new i(2);break;case U:e=P(e,q);break;case L:e=P(e,"-cot");break;case T:e.fname=L,e.multiplier.negate(),e.power=new i(2);break;case S:e=r.parse("(sqrt(1-("+s(e.args[0])+")^2))^(-1)");break;case x:e=r.parse("-(sqrt(1-("+s(e.args[0])+")^2))^(-1)");break;case C:e=r.parse("(1+("+s(e.args[0])+")^2)^(-1)");break;case"acot":e=r.parse("-1/(("+e.args[0]+")^2+1)");break;case h:N=e.multiplier.clone(),e.toUnitMultiplier(),(l=e.args[0].clone()).toUnitMultiplier(),(e=r.parse(o(s(e.args[0]))+"/abs"+o(s(l)))).multiplier=N;break;case"parens":e=a(1);break;case"cosh":e.fname="sinh";break;case"sinh":e.fname="cosh";break;case"tanh":e.fname="sech",e.power=new i(2);break;case"sech":e=P(e,"-tanh");break;case"csch":var E=String(e.args[0]);return r.parse("-coth("+E+")*csch("+E+")");case"asinh":e=r.parse("(sqrt(1+("+s(e.args[0])+")^2))^(-1)");break;case"acosh":e=r.parse("(sqrt(-1+("+s(e.args[0])+")^2))^(-1)");break;case"atanh":e=r.parse("(1-("+s(e.args[0])+")^2)^(-1)");break;case"asech":E=String(e.args[0]);e=r.parse("-1/(sqrt(1/("+E+")^2-1)*("+E+")^2)");break;case"acoth":e=r.parse("-1/(("+e.args[0]+")^2-1)");break;case"acsch":E=String(e.args[0]);e=r.parse("-1/(sqrt(1/("+E+")^2+1)*("+E+")^2)");break;case"Si":E=e.args[0];e=r.parse("sin("+E+")/("+E+")");break;case"Shi":E=e.args[0];e=r.parse("sinh("+E+")/("+E+")");break;case"Ci":E=e.args[0];e=r.parse("cos("+E+")/("+E+")");break;case"Chi":E=e.args[0];e=r.parse("cosh("+E+")/("+E+")");break;case"Ei":E=e.args[0];e=r.parse("e^("+E+")/("+E+")");break;case"erf":e=r.parse("(2*e^(-("+e.args[0]+")^2))/sqrt(pi)");break;case"atan2":var R=String(e.args[0]),F=String(e.args[1]);e=r.parse("("+F+")/(("+F+")^2+("+R+")^2)");break;case"sign":e=new a(0);break;case"log10":e=r.parse("1/(("+e.args[0]+")*ln(10))");break;default:e=r.symfunction("diff",[e,p])}else if(b===d||b===t&&n(e.power)){var H;H=b===d?e.value:b===t&&e.contains(A)?e.fname+o(s(e.args[0])):e.value+o(s(e.args[0])),r.multiply(r.parse(y+o(H)),e.power.clone()),l=V.diff(r.multiply(r.parse(y+o(H)),e.power.clone()),A),e=r.multiply(e,l)}else if(b!==t||e.power.equals(1)){if(b===m||b===g){var Q=new a(0);for(var O in e.symbols)Q=r.add(Q,V.diff(e.symbols[O].clone(),A));e=r.multiply(I(e.clone()),Q)}}else(l=e.clone()).toLinear(),l.toUnitMultiplier(),e=r.multiply(I(e.clone()),B(l))}return e.updateHash(),e}function P(e,i,n){return r.multiply(e,r.parse(i+o(n||s(e.args[0]))))}},integration:{u_substitution:function(i,n){function s(e,i,t){var a=t?t(e,i):r.divide(e.clone(),V.diff(i,n));return a.contains(n,!0)?null:a}function o(e,i){var n=V.integrate(r.symfunction(e,[new a(g)]),g,0);return(n=n.sub(new a(g),i)).updateHash(),n}var l,p=i[0].clone(),u=i[1].clone(),c=p.group,f=u.group,g="__u__";if(c===t&&f!==t){if(l=s(u,(m=p.args[0]).clone()))return r.multiply(l,o(p.fname,m));if(l=s(u,p))return V.integration.poly_integrate(p)}else if(f===t&&c!==t){var m;if(l=s(p,(m=u.args[0]).clone()))return r.multiply(l,o(u.fname,m))}else if(c===t&&c===t){if(l=s(p.clone(),u.clone()))return r.multiply(V.integration.poly_integrate(u),l);if(l=s(u.clone(),p.clone()))return r.multiply(V.integration.poly_integrate(u),l)}else{if(c===d&&f!==d){if(!(l=s(u,(k=p.power).clone()))){var w=V.integration.decompose_arg(k.clone(),n),v=V.diff(w[2].clone(),n),y=V.integration.decompose_arg(v.clone(),n);if(r.multiply(w[1],y[1]).power.equals(u.power)){var h=r.divide(w[0].clone(),y[0].clone()),b=r.multiply(h.clone(),r.pow(new a(p.value),r.multiply(w[0],new a(g))));return b=r.multiply(b,new a(g)),V.integration.by_parts(b,g,0,{}).sub(g,w[1].clone())}}var _=V.integrate(p.sub(k.clone(),new a(g)),g,0);return r.multiply(_.sub(new a(g),k),l)}if(f===d&&c!==d){var k;l=s(p,(k=u.power).clone());_=V.integrate(u.sub(k,new a(g)),g,0);return r.multiply(_.sub(new a(g),k),l)}if(p.isComposite()||u.isComposite()){var q=function(i,t){var a=e.Algebra.Factor.factor(i),s=e.Algebra.Factor.factor(V.diff(t,n));return r.divide(a,s)},U=p.isComposite()?p.clone().toLinear():p.clone(),L=u.isComposite()?u.clone().toLinear():u.clone();if(l=s(U.clone(),L.clone(),q))return r.multiply(V.integration.poly_integrate(u),l);if(l=s(L.clone(),U.clone(),q))return r.multiply(V.integration.poly_integrate(p),l)}}},poly_integrate:function(e){var i=e.power.toString(),n=e.multiplier.toDecimal(),t=e.toUnitMultiplier().toLinear();return-1===Number(i)?r.multiply(new a(n),r.symfunction(y,[t])):r.parse(p("({0})*({1})^(({2})+1)/(({2})+1)",n,t,i))},stop:function(e){throw new E(e=e||"Stopping!")},partial_fraction:function(i,t,s,o){var l,p;return n(t)||(t=r.parse(t)),l=new a(0),(p=e.Algebra.PartFrac.partfrac(i,t)).group===w&&p.isLinear()?p.each(function(e){l=r.add(l,V.integrate(e,t,s,o))}):l=r.add(l,V.integrate(p,t,s,o)),l},get_udv:function(i){var n=[[],[],[],[],[]],s=function(r){var i=r.group;if(i===t){var a=r.fname;e.Utils.in_trig(a)||e.Utils.in_htrig(a)?n[3].push(r):e.Utils.in_inverse_trig(a)?n[1].push(r):a===y?n[0].push(r):V.integration.stop()}else i===f||r.isComposite()&&r.isLinear()||i===w&&r.isLinear()?n[2].push(r):i===d||r.isComposite()&&!r.isLinear()?n[4].push(r):V.integration.stop()};i.group===w?i.each(function(e){s(a.unwrapSQRT(e,!0))}):s(i);for(var o,l=new a(1),p=0;p<5;p++){var u,c=n[p],g=c.length;if(g>0){if(g>1){u=new a(1);for(var m=0;m<g;m++)u=r.multiply(u,c[m].clone())}else u=c[0].clone();o?l=r.multiply(l,u):(o=u).multiplier=o.multiplier.multiply(i.multiplier)}}return[o,l]},trig_sub:function(i,n,t,a,s,l){(s=s||V.integration.decompose_arg(i.clone().toLinear(),n))[3],s[2];var p=s[0],u=s[1];if(u.power.equals(2)&&p.greaterThan(0)){var c=e.Utils.getU(i),f=r.parse(q+o(c)),g=r.parse(U+o(c)+"^2"),m=r.multiply(i.sub(u,f),g),w=V.integrate(m,c,t,a).sub(f,u);return e.Utils.clearU(f),w}},by_parts:function(i,n,t,s){var o,l,p,u,c,f,g,m,w,d,v,y;if(s.previous=s.previous||[],l=(o=V.integration.get_udv(i))[0],p=o[1],v=(u=a.unwrapSQRT(r.expand(V.diff(l.clone(),n)),!0)).clone().stripVar(n),u=r.divide(u,v.clone()),c=V.integrate(p.clone(),n,t||0),y=(f=r.multiply(c.clone(),u)).toString(),-1!==s.previous.indexOf(y)&&e.Utils.in_trig(l.fname)&&p.isE())return s.is_cyclic=!0,new a(1);if(s.previous.push(y),g=r.multiply(l,c),d=f.multiplier.clone(),f.toUnitMultiplier(),(w=r.multiply(V.integrate(f.clone(),n,t,s),v)).multiplier=w.multiplier.multiply(d),m=r.subtract(g,w),s.is_cyclic&&(s.previous.pop(),0===s.previous.length)){m=r.expand(m);var h=new a(0);m.each(function(e){e.contains(n)||(h=r.add(h,e.clone()))}),m=r.divide(r.subtract(m,h.clone()),r.subtract(new a(1),h))}return m},decompose_arg:e.Utils.decompose_fn},integrate:function(s,c,v,F){if(!c){var I=e.Utils.variables(s);1===I.length&&(c=I[0]),c=c||"x"}if(e.Utils.isVector(s)){var B=new e.Vector([]);return s.each(function(e){B.elements.push(V.integrate(e,c))}),B}return isNaN(c)||r.error("variable expected but received "+c),s.isConstant(!0)?r.multiply(s.clone(),r.parse(c)):(F=F||{},e.Utils.block("PARSE2NUMBER",function(){v=v||0;var I,B=n(c)?c.toString():c,H=a.unwrapSQRT(s.clone(),!0),Q=H.group;try{if(++v>e.Settings.integration_depth&&V.integration.stop("Maximum depth reached. Exiting!"),H.contains(B,!0)){if(Q===f)I=V.integration.poly_integrate(H,B,v);else if(Q===d)if(H.contains(B)&&H.previousGroup!==t){if(H.power.contains(B))V.integration.stop();else(Re=V.diff(H.clone().toLinear(),B)).contains(B)&&V.integration.stop(),I=V.integration.poly_integrate(H,B,v)}else{if((J=V.diff(H.power.clone(),B)).contains(B)){var O=J.stripVar(B);if((K=r.divide(J.clone(),O.clone())).group===f&&K.isLinear())return O.multiplier=O.multiplier.divide(new i(2)),r.parse(p("({2})*(sqrt(pi)*erf(sqrt(-{0})*{1}))/(2*sqrt(-{0}))",O,B,H.multiplier));V.integration.stop()}if(H.isE())I=H;else{var D=r.symfunction(y,[r.parse(H.value)]);I=r.divide(H,D)}I=r.divide(I,J)}else if(H.isComposite()&&H.isLinear()){var j=r.parse(H.multiplier);H.toUnitMultiplier(),I=new a(0),H.each(function(e){I=r.add(I,V.integrate(e,B,v))}),I=r.multiply(j,I)}else if(Q===m)if(H.power.greaterThan(1)&&(H=r.expand(H)),H.power.equals(1))I=new a(0),H.each(function(e){I=r.add(I,V.integrate(e,B,v))},!0);else{var G=Number(H.power);j=H.multiplier.clone();H.toUnitMultiplier();var X=H.clone().toLinear(),Z=(wr=V.integration.decompose_arg(X,B))[3],z=wr[2],J=wr[0],K=wr[1];if(-1===G&&K.group!==g)if(K.group===f&&K.power.equals(2)){var W=function(e){var i=new a(1);return e.each(function(e){i=r.multiply(i,"abs"===e.fname?e.args[0]:e)}),i},Y=J.clone(),$=Z.clone();Y=r.pow(Y,new a(.5)),$=r.pow($,new a(.5));D=r.multiply(W($),W(Y));var ee=r.symfunction(C,[r.divide(r.multiply(J,K.toLinear()),D.clone())]);I=r.divide(ee,D)}else if(K.group===f&&K.isLinear())I=r.divide(V.integration.poly_integrate(H),J);else if(K.power.equals(4)){var re,ie,ne,te,ae,se,oe=o;Y=r.parse(b+oe(J)+"*"+B+"^2"),$=r.parse(b+oe(2)+"*"+oe(J)+"^"+oe("1/4")+"*"+oe(Z)+"^"+oe("1/4")+"*"+B),re=r.parse(b+oe(Z)),be=r.add(r.add(Y.clone(),$.clone()),re.clone()),Ve=r.add(r.subtract(Y,$),re),ie=r.parse(b+oe(2)+"*"+oe(Z)+"^"+oe("3/4")),ne=r.parse(b+oe(Z)+"*"+oe(Z)+"^"+oe("1/4")+"*"+B),te=r.parse("2*"+oe(Z)+"*"+b+oe(2)+"*"+oe(Z)+"^"+oe("1/4")),ae=r.divide(r.subtract(ie.clone(),ne.clone()),r.multiply(te.clone(),Ve)),se=r.divide(r.add(ie,ne),r.multiply(te,be.clone())),I=r.add(V.integrate(ae,B,v,F),V.integrate(se,B,v,F))}else I=V.integration.partial_fraction(H,B,v);else if(-.5===G)if(K.group===f&&K.power.equals(2))if(z.multiplier.lessThan(0)&&!Z.multiplier.lessThan(0))if(J.negate(),Z.isConstant()&&J.isConstant()){D=r.symfunction(b,[J.clone()]);var le=r.symfunction(b,[r.multiply(J.clone(),Z)]);I=r.divide(r.symfunction(S,[r.divide(z.toLinear(),le)]),D)}else{var pe=r.symfunction(b,[J]),ue=r.multiply(pe.clone(),K.clone().toLinear());I=r.divide(r.symfunction(C,[r.divide(ue,r.symfunction(b,[X.clone()]))]),pe)}else V.integration.stop();else V.integration.stop();else if(K.isLinear()&&K.group!==g)I=r.divide(V.integration.poly_integrate(H),J);else{if(K.power.equals(2)&&J.greaterThan(0)){var ce,fe,ge,me,we,de;ce=r.parse(b+o(J)),fe=r.parse(b+o(Z)),ge=r.multiply(ce.clone(),fe.clone()).invert(),me=r.pow(Z,new a(H.power)),de=e.Utils.getU(H),dr=r.multiply(ge,K.clone().toLinear()),we=r.parse(C+o(dr));var ve=2*(Math.abs(H.power)-1),ye=V.integrate(r.parse(k+o(de)+"^"+ve));return e.Utils.clearU(de),r.multiply(ye.sub(de,we),me)}if(H.group===w||H.power.lessThan(0)){ee=H.clone().toLinear();var he=e.Algebra.Factor.factor(ee).toString()!==ee.toString();if(e.Algebra.degree(ee,r.parse(B)).equals(2)&&!he)try{var be,_e,ke;ke=e.Algebra.sqComplete(ee,B),dr=e.Utils.getU(ee),be=ke.f.sub(ke.a,dr),_e=r.pow(be,r.parse(H.power)),I=V.integrate(_e,dr).sub(dr,ke.a)}catch(e){V.integration.stop()}else I=V.integration.partial_fraction(H,B,v,F)}else I=V.integration.by_parts(H,B,v,F)}I.multiplier=I.multiplier.multiply(j)}else if(Q===t){var qe=H.args[0];j=H.multiplier.clone();H.toUnitMultiplier();J=(wr=V.integration.decompose_arg(qe,B))[0],K=wr[1];var Ue=H.fname;if(Ue===y||Ue===S||Ue===x||Ue===C&&K.isLinear()){G=H.power.toString();l(G)&&(v-=G),I=V.integration.by_parts(H,B,v,F)}else{if(Ue===q&&H.power.lessThan(0))return(Tr=H.clone()).power.negate(),Tr.fname=T,V.integrate(Tr,B,v);if(!J.contains(B,!0)&&H.isLinear())if(Ue===h){if((K=r.divide(qe.clone(),J.clone())).group!==f||K.power.lessThan(0))V.integration.stop();else if(e.Utils.even(K.power))I=V.integrate(qe,B,v);else{var Le=V.integrate(K,B,v);Le.power=Le.power.subtract(new i(1)),I=r.multiply(r.multiply(r.symfunction(h,[K.toLinear()]),Le),J)}}else{var Te=H.args[0].group,Se=V.integration.decompose_arg(qe,B);switch((Te!==m&&Te!==f&&Te!==w||!Se[1].power.equals(1)||qe.hasFunc())&&V.integration.stop(),Ue){case k:I=r.symfunction(_,[qe]);break;case _:(I=r.symfunction(k,[qe])).negate();break;case q:I=r.parse(p("ln(sec({0}))",qe));break;case U:I=r.parse(p("ln(tan({0})+sec({0}))",qe));break;case L:I=r.parse(p("-ln(csc({0})+cot({0}))",qe));break;case T:I=r.parse(p("ln(sin({0}))",qe));break;case N:I=r.symfunction(A,[qe]);break;case A:I=r.symfunction(N,[qe]);break;case M:I=r.parse(p("ln(cosh({0}))",qe));break;case"exp":I=V.integrate(r.parse(p("e^({0})",qe)),B,v);break;case"erf":qe=H.args[0].clone();var xe=(_r=V.integration.decompose_arg(qe,B))[1],Ce=_r[0];I=r.parse(p("e^(-(({2}))^2)/(({0})*sqrt(pi))+(1/({0})+({1}))*erf(({2}))",Ce,xe,qe));break;case"sign":I=r.multiply(H.clone(),qe.clone());break;default:V.integration.stop()}I=r.divide(I,J)}else if(K.isLinear()){if(Ue===k||Ue===_)if((G=Number(H.power))<0)H.fname=Ue===_?L:U,H.invert().updateHash(),I=V.integrate(H,B,v);else{qe=H.args[0];var Ne=H.clone(),Ae=H.clone(),Me=new a((G-1)/G),Ee=r.multiply(J.clone(),new a(G)).invert();Ne.power=Ne.power.subtract(new i(1)),Ae.power=Ae.power.subtract(new i(2));var Re=r.symfunction(Ue===k?_:k,[qe.clone()]);Ue===_&&Re.negate(),I=r.add(r.multiply(r.multiply(Ee,Ne),Re),r.multiply(Me,V.integrate(r.parse(Ae),B,v)))}else if(Ue===q||Ue===T){if(H.args[0].isLinear(B)){ve=H.power.subtract(new i(1)).toString();var Fe=H.clone().toUnitMultiplier(),Ie=r.parse(p((Ue===T?"-":"")+"1/({2}*{0})*{3}({1})^({0})",ve,qe,J,Ue));Fe.power=Fe.power.subtract(new i(2)),Fe.power.equals(0)&&(Fe=r.parse(Fe)),I=r.subtract(Ie,V.integrate(Fe,B,v))}}else if(Ue===U||Ue===L){var Be=H.power.subtract(new i(1)).toString(),Pe=H.power.subtract(new i(2)).toString(),Ve=Ue===U?q:T,He=(Fe=H.clone().toUnitMultiplier(),p((Ue===L?"-":"")+"1/({0}*{1})*{4}({3})^({2})*{5}({3})",J,Be,Pe,qe,Ue,Ve));Ie=r.parse(He);Fe.power=Fe.power.subtract(new i(2)),Fe.power.equals(0)&&(Fe=r.parse(Fe)),I=r.add(Ie,r.multiply(new a(Pe/Be),V.integrate(Fe,B,v)))}else Ue!==A&&Ue!==N||!H.power.equals(2)?V.integration.stop():I=V.integrate(H.fnTransform(),B,v)}else V.integration.stop();I.multiplier=I.multiplier.multiply(j)}}else if(Q===g)I=V.integration.partial_fraction(H,B,v);else if(Q===w){var Qe=H.stripVar(B),Oe=r.divide(H.clone(),Qe.clone());if(Oe.group!==w){if(Oe.equals(1))return V.integrate(r.expand(H),B,v);I=V.integrate(Oe,B,v)}else{var De=Oe.collectSymbols().sort(function(e,r){return e.group===r.group?Number(e.power)===Number(r.power)?e<r?1:-1:r.power-e.power:r.group-e.group}).map(function(e){var i=a.unwrapSQRT(e,!0);return"exp"===i.fname?r.parse(p("({1})*e^({0})",i.args[0],i.multiplier)):i});if(2===(Fr=De.length)){try{I=V.integration.u_substitution(De,B)}catch(e){}if(!I){var je=De[0].group,Ge=De[1].group,Xe=De[0],Ze=De[1],ze=Xe.fname,Je=Ze.fname;if(H=r.multiply(Xe.clone(),Ze.clone()),je===t&&Ge===t)if(ze===y||Je===y)I=V.integration.by_parts(H.clone(),B,v,F);else{De.sort(function(e,r){return r.fname>e.fname});var Ke=Xe.args[0];(!Ke.isLinear()||Ke.group!==m&&Ke.group!==w&&Ke.group!==f)&&V.integration.stop(),K=(wr=V.integration.decompose_arg(Ke,B))[1],J=wr[0],K.isLinear()||V.integration.stop();var We=Ze.args[0];if(Ke.equals(We))if(ze===_&&Je===k||ze===k&&Je===_)if(Xe.power.lessThan(0)&&V.integration.stop(),ze===_&&Xe.power.add(Ze.power).equals(0))Xe.fname=q,Xe.updateHash(),I=V.integrate(Xe,B,v);else if(u(Xe.power)&&Je===k&&Ze.power.lessThan(0)){ve=Number(Xe.power)/2;var Ye=r.parse(p("(1-cos({0})^2)^({1})",Xe.args[0],ve));I=V.integrate(r.expand(r.multiply(Ye,Ze.clone())),B,v,F)}else if(u(Xe.power)&&Je===_&&Ze.power.lessThan(0)){ve=Number(Xe.power)/2,Ye=r.parse(p("(1-sin({0})^2)^({1})",Xe.args[0],ve));I=V.integrate(r.expand(r.multiply(Ye,Ze.clone())),B,v,F)}else{var $e=e.Utils.even(Xe.power),er=e.Utils.even(Ze.power);if(I=new a(0),$e&&er){var rr=function(e){var i,n=e.power/2;return i=e.fname===k?"((1/2)+(cos(2*("+e.args[0]+"))/2))^"+n:"((1/2)-(cos(2*("+e.args[0]+"))/2))^"+n,r.parse(i)};J=rr(Xe),Z=rr(Ze),Re=r.multiply(J,Z);return(Tr=r.expand(Re)).each(function(e){I=r.add(I,V.integrate(e,B,v))}),r.multiply(I,Qe)}$e?(dr=Xe,Fe=Ze):(dr=Ze,Fe=Xe);var ir=dr.fname===k?-1:1,nr=((ve=Fe.power)-1)/2,tr=r.parse("(1-"+dr.fname+e.Utils.inBrackets(Ke)+"^2)^"+nr);(Tr=r.expand(r.multiply(new a(ir),r.multiply(dr.clone(),tr)))).each(function(e){I=r.add(I,V.integration.poly_integrate(e.clone()))})}else if(ze===U&&Je===q&&K.isLinear()&&Ze.isLinear())I=r.parse(p("sec({0})^({1})/({1})",Xe.args[0],Xe.power));else if(ze===q&&Je===U&&K.isLinear())if(Xe.isLinear()&&Ze.isLinear())I=r.divide(r.symfunction(U,[Ke.clone()]),J);else if(u(Xe.power)){G=Number(Xe.power)/2,Re=r.parse(p("(sec({0})^2-1)^({1})",Xe.args[0],G));I=V.integrate(r.expand(r.multiply(Re,Ze)),B,v)}else V.integration.stop();else if(ze===U&&Je===k)Xe.fname=k,Xe.invert().updateHash(),I=V.integrate(r.multiply(Xe,Ze),B,v);else if(ze===_&&Je===L)Ze.fname=_,Ze.invert().updateHash(),I=V.integrate(r.multiply(Xe,Ze),B,v);else if(ze!==q||Je!==k&&Je!==_||!Ze.power.lessThan(0)){Re=r.multiply(Xe.fnTransform(),Ze.fnTransform());I=V.integrate(r.expand(Re),B,v)}else{var Re=r.multiply(Xe.fnTransform(),Ze);I=V.integrate(r.expand(Re),B,v)}else if(ze!==_&&ze!==k||Je!==_&&Je!==k)V.integration.stop();else{var ar=P(De);I=V.integrate(r.expand(ar),B,v)}}else if(je===t&&Ge===f){var sr=Xe.isLinear();if(Xe.fname===k&&sr&&Ze.power.equals(-1))I=r.symfunction("Ci",[Xe.args[0]]);else if(Xe.fname===k&&Ze.power.equals(-1))I=V.integrate(r.multiply(Xe.fnTransform(),Ze.clone()),B,v);else if(Xe.fname===A&&sr&&Ze.power.equals(-1))I=r.symfunction("Chi",[Xe.args[0]]);else if(Xe.fname===A&&Ze.power.equals(-1))I=V.integrate(r.multiply(Xe.fnTransform(),Ze.clone()),B,v);else if(Xe.fname===_&&sr&&Ze.power.equals(-1))I=r.symfunction("Si",[Xe.args[0]]);else if(Xe.fname===_&&Ze.power.equals(-1))I=V.integrate(r.multiply(Xe.fnTransform(),Ze.clone()),B,v);else if(Xe.fname===N&&sr&&Ze.power.equals(-1))I=r.symfunction("Shi",[Xe.args[0]]);else if(Xe.fname===N&&Ze.power.equals(-1))I=V.integrate(r.multiply(Xe.fnTransform(),Ze.clone()),B,v);else if(Xe.fname===y&&Ze.power.equals(-1))I=V.integration.poly_integrate(Xe,B,v);else if("erf"===Xe.fname){if(Ze.power.equals(1)){Ce=(_r=V.integration.decompose_arg(Xe.args[0],B))[0],xe=_r[1],qe=Xe.args[0].toString();I=r.parse(p("(e^(-(({2}))^2)*(sqrt(pi)*e^((({2}))^2)*(2*({0})^2*({1})^2-3)*erf(({2}))+2*({0})*({1})-2))/(4*sqrt(pi)*({0})^2)",Ce,xe,qe))}}else I=V.integration.by_parts(H,B,v,F)}else if(je===d&&Ge===f){K=ze===y?V.integration.decompose_arg(Xe.args[0],B)[1]:null;I=Xe.isE()&&(Xe.power.group===f||Xe.power.group===w)&&Ze.power.equals(-1)?r.symfunction("Ei",[Xe.power.clone()]):ze===y&&K.value===Ze.value?V.integration.poly_integrate(Xe,B,v):V.integration.by_parts(H,B,v,F)}else if(je===g&&Ge===f){if(Ze.value===Xe.value&&Xe.power.equals(-1)){var or=Math.min.apply(null,e.Utils.keys(Xe.symbols)),lr=Math.min(or,Ze.power),pr=Ze.clone();pr.power=new i(lr),Ze=r.divide(Ze,pr.clone());Re=new a(0);Xe.each(function(e){Re=r.add(Re,r.divide(e.clone(),pr.clone()))}),Re.multiplier=Xe.multiplier,H=r.divide(Ze,Re)}I=V.integration.partial_fraction(H,B,v)}else if(je===m&&Ge===f){ee=Xe.clone().toLinear();var ur=e.Algebra.degree(ee,r.parse(B)).equals(1);if(Xe.power.equals(-.5)){J=(wr=V.integration.decompose_arg(Xe.clone().toLinear(),B))[0].negate(),K=wr[1],Z=wr[3],G=Number(Ze.power);if(l(G)&&e.Utils.even(G)&&K.power.equals(2)){var cr=r.divide(r.multiply(r.pow(Z.clone(),new a(2)),r.symfunction(b,[r.divide(Z.clone(),J.clone())])),r.pow(J.clone(),new a(2)));cr=r.multiply(cr,r.symfunction(b,[Z]).invert());var fr=r.parse("sin(u)");fr.power=fr.power.multiply(Ze.power);ye=V.integrate(fr,"u",v);var gr=r.parse(S+"("+b+"("+J+"/"+Z+")*"+B+")");I=r.multiply(cr,ye.sub(new a("u"),gr))}}else if(Xe.power.equals(-1)&&Ze.isLinear()&&ur)I=V.integration.partial_fraction(H,B,v);else if(!Xe.power.lessThan(0)&&l(Xe.power)){var mr=r.expand(Xe);I=new a(0),mr.each(function(e){e.group===g?e.each(function(e){I=r.add(I,V.integrate(r.multiply(Ze.clone(),e),B,v))}):I=r.add(I,V.integrate(r.multiply(Ze.clone(),e),B,v))})}else if(Xe.power.lessThan(-2))I=V.integration.by_parts(H,B,v,F);else if(Xe.power.lessThan(0)&&Ze.power.greaterThan(1)){var wr;J=(wr=V.integration.decompose_arg(Xe.clone().toLinear(),B))[0].negate(),K=wr[1],Z=wr[3],X=Xe.clone().toLinear();if(K.group!==g&&K.isLinear()){G=Number(Ze.power);var dr=new a(kr="_u_"),vr=r.expand(r.divide(r.pow(r.subtract(dr.clone(),Z.clone()),new a(G)),dr.clone())),yr={};yr[kr]=X;var hr=r.parse(vr,yr);I=V.integrate(hr,B,0)}else if(Ze.power.greaterThan(K.power)||Ze.power.equals(K.power)){var br=new e.Algebra.Classes.Factors;Xe=e.Algebra.Factor.coeffFactor(Xe.invert(),br),I=new a(0),e.Algebra.divide(Ze,Xe).each(function(e){I=r.add(I,V.integrate(e,B,v))}),br.each(function(e){I=r.divide(I,e)}),I=r.expand(I)}else I=V.integration.partial_fraction(H,B,v)}else if(Xe.power.den.equals(2)){var _r;J=(_r=V.integration.decompose_arg(Xe.clone().toLinear(),B))[3],K=_r[1],Z=_r[0],_r[2];if(K.power.equals(2)&&Z.lessThan(0)){J.equals(1)||(Qe=r.multiply(Qe,r.pow(J,new a(2))));dr=B,cr=r.divide(r.pow(Z.clone().negate(),new a(.5)),r.pow(J,new a(.5)));var kr=r.symfunction(k,[new a(dr)]),qr=r.pow(r.symfunction(k,[new a(dr)]),new a(Xe.power.num)),Ur=r.pow(r.symfunction(_,[new a(dr)]),new a(Ze.power)),Lr=r.multiply(r.multiply(qr,kr),Ur);ye=V.integrate(Lr,dr,v);I=ye.sub(dr,r.symfunction(S,[r.multiply(new a(B),cr)]))}}else ur&&(I=V.integration.partial_fraction(H,B,v))}else if(Xe.isComposite()&&Ze.isComposite())if(I=new a(0),Xe.power.greaterThan(0)&&Ze.power.greaterThan(0)){var Tr;(Tr=r.expand(H)).each(function(e){I=r.add(I,V.integrate(e,B,v))},!0)}else{var Sr=Number(Xe.power),xr=Number(Ze.power);if(Sr<0&&xr>0){Re=Xe;Xe=Ze,Ze=Re}Xe.each(function(e){I=r.add(I,V.integrate(r.multiply(e,Ze.clone()),B,v))})}else if(je===m&&De[0].power.greaterThan(0))Xe=r.expand(Xe),I=new a(0),Xe.each(function(e){I=r.add(I,V.integrate(r.multiply(e,Ze.clone()),B,v))},!0);else if(je===t&&Ge===d&&e.Utils.in_htrig(Xe.fname))Xe=Xe.fnTransform(),I=V.integrate(r.expand(r.multiply(Xe,Ze)),B,v);else if(je===t&&Ge===m||Ge===t&&je===m){if(Ge===t&&je===m){Re=Xe;Xe=Ze,Ze=Re}var Cr,Nr,Ar;if(kr=a.unwrapSQRT(V.diff(Xe.clone(),B),!0),Cr=a.unwrapSQRT(Ze,!0),kr.power.equals(Cr.power)){if(G=new a(Ze.power),Nr=kr.clone().toLinear(),Ar=Ze.clone().toLinear(),(Me=e.Algebra.divide(Nr.toLinear(),Ar)).isConstant()){var Mr=r.pow(Me,G.negate());I=r.multiply(Mr,V.integration.poly_integrate(Xe.clone()))}}else I=V.integration.by_parts(H,B,v,F)}else I=V.integration.by_parts(H,B,v,F)}}else if(3===Fr&&(De[2].group===f&&De[2].power.lessThan(2)||De[0].group===m)){var Er=De[0];if(Er.group===m){Er.power.greaterThan(1)&&(Er=r.expand(Er));Fe=r.multiply(De[1],De[2]);I=new a(0),Er.each(function(e){var i=r.multiply(e,Fe.clone()),n=V.integrate(i,B,v);I=r.add(I,n)},!0)}else I=V.integration.by_parts(H,B,v,F)}else if(R(De)){Re=new a(1);for(var Rr=0,Fr=De.length;Rr<Fr;Rr++)Re=r.multiply(Re,De[Rr].fnTransform());Re=r.expand(Re),I=V.integrate(Re,B,v)}else{ar=P(De);I=V.integrate(r.expand(ar),B,v)}}I=r.multiply(I,Qe)}}else I=r.multiply(H.clone(),r.parse(B));if(I)return I}catch(r){if(!(r instanceof E||r instanceof e.exceptions.DivisionByZero))throw r}return r.symfunction("integrate",[s,c])},!1))},defint:function(i,n,t,s){var o,l=e.Utils.variables(i),p=V.integrate(i,s);if(1===l.length&&(s=l[0]),p.hasIntegral())if(1===l.length&&n.isConstant()&&t.isConstant()){var u=e.Utils.build(i);o=new a(e.Math2.num_integrate(u,Number(n),Number(t)))}else o=r.symfunction("defint",[i,n,t,s]);else{var c,f,g={},m={};g[s]=t,m[s]=n,c=r.parse(p,g),f=r.parse(p,m),o=r.subtract(c,f)}return o},limit:function(i,n,t){var s=function(i){try{return r.parse(i.sub(n,t))}catch(r){if(r instanceof e.exceptions.UndefinedError)return;throw new Error("Stopping!")}};try{var o,l,p,u,c,f,g;p=i.getNum(),u=i.getDenom(),o=s(p),l=s(u),10,f=p,g=u;for(var m=0;void 0===o&&void 0===l||o.equals(0)&&l.equals(0)||o.isInfinty&&l.isInfinity;){if(m>10){var w={};w[n]=t;try{return e.Utils.block("PARSE2NUMBER",function(){return r.parse(i,w)},!0)}catch(r){throw e.exceptions.MaximumIterationsReached()}}f=V.diff(f,n),g=V.diff(g,n),o=s(f.clone()),l=s(g.clone()),m++}return o.isConstant(!0)||l.isConstant(!0)?c=l.equals(0)?a.infinity():r.divide(o,l):o.isInfinity?c=o:l.isInfinity&&(c=l),c}catch(e){return r.symfunction("limit",arguments)}}};nerdamer.register([{name:"diff",visible:!0,numargs:[1,3],build:function(){return V.diff}},{name:"integrate",visible:!0,numargs:[1,2],build:function(){return V.integrate}},{name:"defint",visible:!0,numargs:[3,4],build:function(){return V.defint}},{name:"limit",visible:!0,numargs:3,build:function(){return V.limit}}]),nerdamer.api()}();